<div class="row currentStepTitleRow">
	<div class="col-xs-12">
		<div class="container">
			<h2 class="current stepTitle" id="step1">
				<span class="current stepTitleNumber">1</span>
				<span style="display:inline-block;overflow:hidden;width:80%;vertical-align:middle">
				#i18n{module.appointment.ants.appointmenttitresearch.form.legend}
				</span>
			</h2>
		</div>
	</div>
</div>

<div class="row currentStepContentRow">
	<div class="col-xs-12">
		<div class="container" id="current_step">
		 <form method="post" class="form-horizontal" action="jsp/site/Portal.jsp?page=appointmentants&action=presearch" >
			 <@messages errors=errors />
			 <input name="page" value="appointmentants" type="hidden">
		 	<div class="row">
		 		<div class="col-xs-12 col-sm-6">
		 			<div class="form-group" id="input-container">
		 				<label class="label-text"> #i18n{module.appointment.ants.predemandenumber.label} </label>
		 				<div class="col-xs-12 col-sm-8">
		 					 <input type="number" class="form-control" id="totalPersonsInput"  name="totalPersonsInput" min="1" max="6" value="1"
                                           oninput="handleNumberChange(event)" onkeydown="event.preventDefault()" required />
                             <p class="help-text"><small>#i18n{module.appointment.ants.predemandenumber.help}</small> </p>
		 				</div>
		 			 </div>
		 			 <div class="form-group">
		 				<label class="col-xs-12 col-sm-4 control-label" id="label-default">#i18n{module.appointment.ants.predemandeserial.label_default} </label>
		 				<div class="col-xs-12 col-sm-8">
		 					<input type="text" class="form-control" name="predemande_code_1"  id="predemande_code_1" pattern="[A-Z0-9]{10}" maxlength=10 required />
                            <p class="help-text"><small>#i18n{module.appointment.ants.predemandeserial.help}  <a href="https://ants.gouv.fr/"> ants.gouv.fr</a></small></span>
		 					<div id="warning-message" style="color: red;"></div>
		 				</div>
		 			 </div>
		 			 <!-- This container will hold dynamically added inputs -->
		 			 <div class="form-group">
		 				<@button type="submit" class="btn btn-primary" name="action_presearch" buttonIcon='check' />
		 			 </div>
		 		</div>
		 		<div  class="col-xs-12 col-sm-6">
		 			<div  class="col-xs-12 col-sm-6">
						<div class="formGroupContainer" id="message-search"></div>
					</div>
		 		</div>
		 	</div>
		 </form>
		</div>
	</div>
</div>

<script>

    function handleNumberChange(event) {
        const inputValue = parseInt(event.target.value);
        const inputContainer = document.getElementById('input-container');
        const labelDefault = document.getElementById('label-default');
        const labels = [
            "#i18n{module.appointment.ants.predemandeserial.label_default}",
            "#i18n{module.appointment.ants.predemandeserial.label_1}",
            "#i18n{module.appointment.ants.predemandeserial.label_2}",
            "#i18n{module.appointment.ants.predemandeserial.label_3}",
            "#i18n{module.appointment.ants.predemandeserial.label_4}",
            "#i18n{module.appointment.ants.predemandeserial.label_5}",
            "#i18n{module.appointment.ants.predemandeserial.label_6}"
        ];

        // Clear existing inputs except the first one
        while (inputContainer.childElementCount > 2) {
            inputContainer.removeChild(inputContainer.lastChild);
        }

        // handle label-default
        labelDefault.textContent = labels[inputValue > 1 ? 1 : 0];

        // Create additional input elements based on the entered number
        const fragment = document.createDocumentFragment();
        for (let i = 2; i <= inputValue; i++) {
            const inputRow = document.createElement("div");
            inputRow.classList.add("input-row");

            const inputLabel = document.createElement("label");
            inputLabel.textContent = labels[i];
            inputRow.appendChild(inputLabel);

            const inputWrapper = document.createElement("div");
            inputWrapper.classList.add("input-wrapper");

            const inputElement = document.createElement("input");
            inputElement.type = "text";
            inputElement.name = "predemande_code_" + i;
            inputElement.id= "predemande_code_" + i;
            inputElement.pattern="[A-Z0-9]{10}";
            inputWrapper.appendChild(inputElement);

            const helpText = document.createElement("span");
            helpText.classList.add("help-text");
            var antsLink = '<a href="https://ants.gouv.fr">ants.gouv.fr</a>';
            helpText.innerHTML = "#i18n{module.appointment.ants.predemandeserial.help}".concat(" ").concat(antsLink);
            inputWrapper.appendChild(helpText);
            
            inputRow.appendChild(inputWrapper);
            fragment.appendChild(inputRow);
        }

        inputContainer.appendChild(fragment);
    }
    
    $( function(){
    	$('#message-search').html( $('#searchmessage').html() );
    });
     
</script>

